<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tiny Level Editor (tiles + spawn)</title>
<style>
  :root { --tile: 28; --grid:#cfd8dc; --wall:#000; --floor:#fff; --spawn:#1976d2; }
  body{margin:0;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f7f9fb;color:#222}
  header,footer{padding:10px 12px;background:#fff;position:sticky;top:0;box-shadow:0 1px 0 rgba(0,0,0,.05);z-index:1}
  main{padding:12px;display:grid;gap:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input[type=number]{width:80px}
  button{padding:6px 10px;border-radius:8px;border:1px solid #c7d0d9;background:#fff;cursor:pointer}
  button.primary{background:#0ea5e9;border-color:#0ea5e9;color:#fff}
  canvas{background:var(--floor);touch-action:none;image-rendering:pixelated;box-shadow:0 6px 24px rgba(0,0,0,.1)}
  textarea{width:100%;min-height:120px}
  .tool{padding:4px 8px;border:1px solid #c7d0d9;border-radius:6px;user-select:none}
  .tool.active{background:#e0f2fe;border-color:#0ea5e9}
</style>
</head>
<body>
<header>
  <div class="row">
    <label>Width <input id="w" type="number" min="4" max="200" value="24"></label>
    <label>Height <input id="h" type="number" min="4" max="200" value="12"></label>
    <button id="make" class="primary">Make Grid</button>
    <span class="tool" id="paintWall">Wall (#)</span>
    <span class="tool" id="paintErase">Erase ( )</span>
    <span class="tool" id="paintSpawn">Spawn (P)</span>
    <button id="exportBtn">Export ASCII</button>
    <button id="importBtn">Import ASCII</button>
  </div>
</header>

<main>
  <canvas id="cv" width="800" height="480"></canvas>
  <section>
    <strong>ASCII</strong>
    <textarea id="ascii"></textarea>
  </section>
  <section>
    <em>Tips:</em> Click/drag to paint. Press <strong>P</strong> to toggle Spawn tool quickly. Zoom your browser if you want bigger tiles.
  </section>
</main>

<script>
let grid = [], W=24, H=12, spawn = {x:1,y:1}, tool = "wall";
const cv = document.getElementById('cv'), ctx = cv.getContext('2d');
const asciiEl = document.getElementById('ascii');
const tools = { wall:document.getElementById('paintWall'),
                erase:document.getElementById('paintErase'),
                spawn:document.getElementById('paintSpawn') };

document.getElementById('w').oninput = e => W = clamp(+e.target.value, 4, 200);
document.getElementById('h').oninput = e => H = clamp(+e.target.value, 4, 200);
document.getElementById('make').onclick = () => { makeGrid(W,H); fit(); draw(); syncAscii(); };
document.getElementById('exportBtn').onclick = () => { syncAscii(); asciiEl.select(); document.execCommand('copy'); };
document.getElementById('importBtn').onclick = () => { importAscii(asciiEl.value); fit(); draw(); };
Object.entries(tools).forEach(([k,el]) => el.onclick = ()=>setTool(k));
addEventListener('keydown', e => { if (e.key.toLowerCase()==='p') setTool('spawn'); });

function setTool(t){ tool=t; for (const [k,el] of Object.entries(tools)) el.classList.toggle('active', k===t); }
function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }

// initial
makeGrid(W,H); fit(); draw(); syncAscii(); setTool('wall');

// painting
let down=false;
cv.addEventListener('pointerdown', e => { down=true; paint(e); });
cv.addEventListener('pointermove', e => { if (down) paint(e); });
addEventListener('pointerup',   () => down=false);
cv.addEventListener('contextmenu', e => e.preventDefault());

function paint(e){
  const {x,y} = toCell(e);
  if (!inBounds(x,y)) return;
  if (tool==='wall'){ grid[y][x] = '#'; }
  else if (tool==='erase'){ grid[y][x] = ' '; }
  else if (tool==='spawn'){ spawn = {x,y}; tool='wall'; setTool('wall'); }
  draw(); syncAscii();
}

function makeGrid(w,h){
  W=w; H=h;
  grid = Array.from({length:H}, ()=>Array.from({length:W}, ()=> ' '));
  spawn = {x:1,y:1};
}

function importAscii(text){
  const rows = text.trim().split('\n');
  H = rows.length; W = Math.max(...rows.map(r=>r.length));
  grid = Array.from({length:H}, (_,y)=>Array.from({length:W},(_,x)=>{
    const ch = rows[y][x] ?? ' '; if (ch==='P'){ spawn={x,y}; return ' '; } return ch;
  }));
  document.getElementById('w').value = W;
  document.getElementById('h').value = H;
}

function syncAscii(){
  const lines = grid.map((row,y)=>row.map((ch,x)=> (x===spawn.x && y===spawn.y) ? 'P' : ch).join(''));
  asciiEl.value = lines.join('\n');
}

function toCell(e){
  const rect = cv.getBoundingClientRect();
  const px = e.clientX - rect.left, py = e.clientY - rect.top;
  const tw = cv.width / W, th = cv.height / H;
  return { x: Math.floor(px / tw), y: Math.floor(py / th) };
}
function inBounds(x,y){ return x>=0 && y>=0 && x<W && y<H; }

function fit(){
  // scale canvas to keep aspect and use available width
  const maxW = Math.min(innerWidth - 24, 1100);
  const aspect = W / H;
  let cw = maxW, ch = Math.round(cw / aspect);
  const maxH = innerHeight * 0.6;
  if (ch > maxH){ ch = Math.round(maxH); cw = Math.round(ch * aspect); }
  cv.width = cw; cv.height = ch;
}

addEventListener('resize', () => { fit(); draw(); });

function draw(){
  const tw = cv.width / W, th = cv.height / H;
  // background
  ctx.fillStyle = getCSS('--floor','#fff'); ctx.fillRect(0,0,cv.width,cv.height);
  // gridlines
  ctx.strokeStyle = getCSS('--grid','#cfd8dc'); ctx.lineWidth = 1;
  ctx.beginPath();
  for (let x=0;x<=W;x++){ const px = Math.round(x*tw)+.5; ctx.moveTo(px,0); ctx.lineTo(px,cv.height); }
  for (let y=0;y<=H;y++){ const py = Math.round(y*th)+.5; ctx.moveTo(0,py); ctx.lineTo(cv.width,py); }
  ctx.stroke();

  // tiles
  for (let y=0;y<H;y++) for (let x=0;x<W;x++){
    if (grid[y][x]==='#'){
      ctx.fillStyle = getCSS('--wall','#000');
      ctx.fillRect(Math.round(x*tw), Math.round(y*th), Math.ceil(tw), Math.ceil(th));
    }
  }
  // spawn
  ctx.fillStyle = getCSS('--spawn','#1976d2');
  ctx.fillRect(Math.round(spawn.x*tw)+Math.floor(tw*0.2), Math.round(spawn.y*th)+Math.floor(th*0.2),
               Math.ceil(tw*0.6), Math.ceil(th*0.6));
}
function getCSS(varName, fallback){ return getComputedStyle(document.documentElement).getPropertyValue(varName).trim() || fallback; }
</script>
</body>
</html>
